---
title: "HW6"
author: "Ben Spanswick"
date: "October 9, 2018"
output:
  word_document: default
  html_document: default
---

##Question 1

	a. This data set is a survey of every known healthcare facility that offers mental health services in the United States in 2015. Navigate to https://datafiles.samhsa.gov/study-dataset/national-mental-health-services-survey-2015-n-mhss-2015-ds0001-nid17098 and select the R download. Look through the codebook PDF for an explanation on certain variables. Upon opening the RDA file, the data set should be inserted into your global environment, which you can then reference. 

	b. Please create code which lists the State abbreviations without their counts, one abbreviation per State value. It does not have to be in data frame format. A vector is fine. 
	
```{r}

load("N-MHSS-2015-DS0001-data-r.rda")
mh2015_puf <- as.data.frame(mh2015_puf)

unique(mh2015_puf$LST)

```

	c. Filter the data.frame from 1A. We are only interested in the Veterans Administration (VA) medical centers in the mainland United States—create a listing of counts of these centers by state, including only mainland locations. Alaska, Hawaii, and U.S. territories should be omitted. DC, while not a state, is in the mainland, so it should remain included. Convert this to data.frame() 
	
```{r}

mh2015_puf$LST <- gsub('\\s+', '', mh2015_puf$LST)

myvars <- c("AS", "GU", "PR", "VI", "HI", "AK") 

newdata<-subset(mh2015_puf, mh2015_puf$LST!=myvars)
newdata <- subset(newdata, newdata$PUBLICAGENCY == "Department of Veterans Affairs")

VA_fac <- unique(newdata[c("LST", "CASEID")])


```


	d. Create a ggplot barchart of this filtered data set. Vary the bar’s colors by what State it has listed. Give it an appropriately professional title that is centered. Make sure you have informative axis labels. The State axis should be readable, not layered over each other. You’re welcome to have a legend or not. 

```{r}
library(ggplot2)

plott <- ggplot(VA_fac, aes(format(LST))) +
    geom_bar(stat = "count") +
    labs(x = "Month")

  
print(plott + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + labs( title= "VA Hospitals by State", y="Number of Hopsitals", x = "State"))

```

##Question 2

a. This graph (1D) might be somewhat misleading, as bigger states may have more hospitals, but could be more sparsely located. Read statesize.csv into your R environment. This contains essentially a vector of square miles for each state. In trying to merge it with your data.frame() from 1C, you find that they don’t match. Use paste() on your LST column in 1C to see what the matter is, and write what you observe in a comment. 

I actually addressed the issue earlier. There is a whitespace character in the mh2015 dataset meaning that the abbreviations are not exactly the same. 

```{r}

statesize = read.csv("statesize.csv", header = T)

statesize <- as.data.frame(statesize)

head(statesize)

paste(VA_fac$LST)
paste(statesize$Abbrev)

```

	b. Correct the problem with the LST column using any method in R that is programmatic and easily understandable. Once you have made these state abbreviations identical to statesize.csv’s Abbrev column, merge the data.frame() from 1C and statesize.csv in order to add size information. 
	
We correct with using a bit of regex and gsub

Honestly, no clue why this isnt joining. Cant continue. /end

```{r}

#VA_fac$LST <- gsub('\\s+', '', VA_fac$LST)
#statesize$Abbrev<- gsub('\\s+', '', statesize$Abbrev)

#VA_fac$LST <- trimws(VA_fac$LST)
#statesize$Abbrev<- trimws(statesize$Abbrev)

#VA_fac$LST <- as.factor(VA_fac$LST)
#statesize$Abbrev <- as.factor(statesize$Abbrev)


library(data.table)
#VA <- as.data.table(VA_fac)
#state <- as.data.table(statesize)

#setkey(VA, LST)
#setkey(state, Abbrev)
#VA[,list(state)]

```


c. Calculate a new variable in your combined data.frame() which indicates the VA hospitals per thousand square miles. 


```{r}

library(dplyr)
# 
# VA_fac$LST <- as.factor(VA_fac$LST)
# 
# 
# 
# joined = cbind(probes[match(names(value), probes$probe_id),], value)
# 
# right_join(VA_fac, statesize, by = c("RST" = "Abbrev"))
# 
# 
# 
# m2 <- merge(VA_fac$LST, statesize$Abbrev)
# 
# 
# VA_fac$per1k <- with(VA_fac, x + y - 2)


```
	
	